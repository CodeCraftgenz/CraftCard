RewriteEngine On

# Nunca reescrever arquivos de upload (resumes, fotos, etc.)
RewriteRule ^uploads/ - [L]

# Se o arquivo ou diretorio existe, serve direto
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d

# Caso contrario, redireciona para index.html (SPA fallback)
RewriteRule ^ index.html [QSA,L]

# === Cache Control ===

# HTML e Service Worker: NUNCA cachear (sempre buscar do servidor)
<FilesMatch "\.(html|htm)$">
  Header set Cache-Control "no-cache, no-store, must-revalidate"
  Header set Pragma "no-cache"
  Header set Expires "0"
</FilesMatch>

<FilesMatch "sw\.js$">
  Header set Cache-Control "no-cache, no-store, must-revalidate"
  Header set Pragma "no-cache"
  Header set Expires "0"
</FilesMatch>

<FilesMatch "registerSW\.js$">
  Header set Cache-Control "no-cache, no-store, must-revalidate"
</FilesMatch>

# Assets com hash no nome (ex: index-CZ49Fr20.css): cache longo (1 ano)
<FilesMatch "\.(js|css)$">
  Header set Cache-Control "public, max-age=31536000, immutable"
</FilesMatch>

# Imagens e fontes: cache medio (30 dias)
<FilesMatch "\.(png|jpg|jpeg|gif|svg|ico|woff2|woff|ttf|webp)$">
  Header set Cache-Control "public, max-age=2592000"
</FilesMatch>

# Manifest: cache curto (1 hora)
<FilesMatch "manifest\.webmanifest$">
  Header set Cache-Control "public, max-age=3600"
</FilesMatch>
