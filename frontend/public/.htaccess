RewriteEngine On

# Nunca reescrever arquivos de upload (resumes, fotos, etc.)
RewriteRule ^uploads/ - [L]

# Se o arquivo ou diretorio existe, serve direto
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d

# Caso contrario, redireciona para index.html (SPA fallback)
RewriteRule ^ index.html [QSA,L]

# === Cache Control ===
<IfModule mod_headers.c>

  # 1. HTML: NUNCA cachear (sempre buscar do servidor)
  <FilesMatch "\.(html|htm)$">
    Header set Cache-Control "no-cache, no-store, must-revalidate"
    Header set Pragma "no-cache"
    Header set Expires "0"
  </FilesMatch>

  # 2. Service Worker / PWA: NUNCA cachear
  <FilesMatch "(sw|registerSW|push-sw|workbox-.*)\.js$">
    Header set Cache-Control "no-cache, no-store, must-revalidate"
    Header set Pragma "no-cache"
    Header set Expires "0"
  </FilesMatch>

  # 3. Manifest: cache curto (1 hora)
  <FilesMatch "manifest\.webmanifest$">
    Header set Cache-Control "public, max-age=3600"
  </FilesMatch>

  # 4. Imagens e fontes: cache medio (30 dias)
  <FilesMatch "\.(png|jpg|jpeg|gif|svg|ico|woff2|woff|ttf|webp)$">
    Header set Cache-Control "public, max-age=2592000"
  </FilesMatch>

  # 5. JS/CSS dentro de /assets/ (com hash no nome): cache longo (1 ano, imutavel)
  #    Estes arquivos TEM hash gerado pelo Vite â€” quando o codigo muda, o hash muda
  <FilesMatch "^assets/.+\.(js|css)$">
    Header set Cache-Control "public, max-age=31536000, immutable"
  </FilesMatch>

</IfModule>
